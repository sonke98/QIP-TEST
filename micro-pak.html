<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Micro Pak</title>

<style>
* {
    box-sizing: border-box;
    max-width: 100%;
    word-wrap: break-word;
}

body {
    background: #f4f6f9;
    font-family: "Helvetica", Arial, sans-serif;
    font-size: 12px;
    margin: 0;
    padding: 20px;
}

h2 { text-align: center; }

/* ===== QUESTION ===== */
.question {
    background: #fff;
    padding: 5px;
    border-radius: 6px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
.question h3 {
    font-size: 13px;
    margin-bottom: 6px;
}
textarea {
    width: 100%;
    min-height: 80px;
    padding: 10px;
    font-family: inherit;
}
.options label {
    display: block;
}

/* ===== BUTTON ===== */
button {
    display: block;
    margin: 20px auto;
    padding: 10px 25px;
    font-size: 16px;
    background: #007bff;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

/* ===== TITLE ===== */
.title-quiz table {
    width: 190mm;
    border-collapse: collapse;
}
.title-quiz th,
.title-quiz td {
    border: 1px solid #000;
    padding: 5px 10px;
}

/* ===== PDF AREA ===== */
#pdf-area {
    width: 210mm;
    padding: 10mm;
    background: #fff;
    margin: auto;
}

/* ===== PRINT ===== */
@media print {
    body { background: #fff; margin: 0; padding: 0; }
    button, #result { display: none !important; }
    .question, table {
        page-break-inside: avoid;
        box-shadow: none !important;
        border-radius: 0 !important;
    }
}
textarea
{
    min-height: 120px;
}
</style>
</head>

<body>

<div id="pdf-area">
<div class="title-quiz">
<table width="100%">
    <tr>
        <th colspan="4">
            <h2 id="name-test">BÀI KIỂM TRA TRẮC NGHIỆM VỀ MICRO PAK</h2>
        </th>
    </tr>
    <tr>
        <td colspan="2"><b>Họ và tên:</b> <input style="border: none;" type="text" placeholder="Nhập họ tên......................" id="fullname"></td>
        <td style="text-align:center;font-weight:bold;">Điểm Mark</td>
        <td style="text-align:center;font-weight:bold;"> Ghi chú Mark</td>
    </tr>
    <tr>
        <td colspan="2"><b>Số thẻ / ID: </b><input style="border: none;" type="text" placeholder="Nhập số thẻ..................." id="empid"></td>
        <td rowspan="3" id="scoreCell" style="text-align:center;font-weight:bold;"></td>
        <td rowspan="3" id="resultCell" style="text-align:center;font-weight:bold;"></td>
    </tr>
    <tr>
        <td colspan="2" id="current-date"><b>Ngày Date: </b></td>
    </tr>
    <tr>
        <td colspan="2"><b>Thời gian Time: </b>30 Phút</td>
    </tr>
</table>
</div>

<div id="quiz"></div>
<hr style="height:2px; background-color:black">
</div>
<h5 style="text-align: center;"><i>(Ghi chú) Dưới 70 điểm là không đạt)</i></h5>
<p style="text-align: center;"><i>Chi tiết thắc mắc liên hệ Bella phòng chất lượng để được hỗ trợ</i></p>
<button onclick="submitQuiz()">Nộp bài</button>
<div id="result"></div>
<script>
let db;

function openDB() {
    const request = indexedDB.open("QIP_Quiz_DB", 1);

    request.onupgradeneeded = function (e) {
        db = e.target.result;
        db.createObjectStore("results", {
            keyPath: "id",
            autoIncrement: true
        });
    };

    request.onsuccess = function (e) {
        db = e.target.result;
        console.log("IndexedDB ready");
    };

    request.onerror = function () {
        alert("Không mở được IndexedDB");
    };
}

openDB();
</script>
<script>
    // 1. Lấy đối tượng ngày giờ hiện tại
    const today = new Date();

    // 2. Lấy các thành phần ngày tháng
    const day = today.getDate(); // Ngày (1-31)
    const month = today.getMonth() + 1; // Tháng (0-11, cộng 1 để ra 1-12)
    const year = today.getFullYear(); // Năm (4 chữ số)

    // 3. (Tùy chọn) Lấy tên ngày trong tuần
    const days = ["Chủ nhật", "Thứ hai", "Thứ ba", "Thứ tư", "Thứ năm", "Thứ sáu", "Thứ bảy"];
    const dayOfWeek = days[today.getDay()];

    // 4. Định dạng ngày tháng (ví dụ: 20/01/2026)
    // Thêm số 0 ở đầu nếu ngày hoặc tháng < 10 (ví dụ: 01, 02)
    const formattedDay = day < 10 ? '0' + day : day;
    const formattedMonth = month < 10 ? '0' + month : month;
    const formattedDate = `${formattedDay}/${formattedMonth}/${year}`; // Dùng template literals

    // 5. Gán ngày tháng đã định dạng vào phần tử HTML có id="current-date"
    document.getElementById("current-date").innerHTML =  `<b>Ngày Date: </b> ${dayOfWeek}, ${formattedDate}`;
/* ====== DATA (GIỮ NGUYÊN) ====== */
const quizData = [
    {
        type: "choice",
        question: "Những loại nào được lưu trữ cách sàn nhà và trên pallet nhựa hoặc giá đỡ (cách tường ngoài 50 cm, cách cửa sổ hoặc cửa ra vào bên ngoài 150 cm)? (20 điểm)",
        options: { 
            a: "Vật liệu, các chi tiết chặt và vật liệu được lưu trữ", 
            b: "Các bộ phận hoặc vật liệu may", 
            c: "Vật liệu đóng gói, hàng bán thành phẩm và hàng hóa thành phẩm", 
            d: "Tất cả abc đều đúng" 
        },
        correct: "b",
        score: 20
    },
    {
        type: "choice",
        question: "Không tìm thấy ẩm/ nấm mốc trên các loại bên dưới như? (20 điểm)",
        options: {
            a: "Trên tường, trần nhà, kệ, pallet",
            b: "Trên vật tư & vật liệu (nguyên liệu thô, da, vải, da tồn, da lộn bò tồn, da bò lộn)",
            c: "Trên bộ vị giày, bán thành phần hoặc thành phẩm và thùng carton xuất khẩu",
            d: "Trên vật liệu đóng gói (hộp giày, khăn giấy, thùng carton)",
            e: "Tất cả a, b, c, d đều đúng"
        },
        correct: "c",
        score: 20
    },
    {
        type: "choice",
        question: "Trong tất cả các kho, độ ẩm tiêu chuẩn là bao nhiêu ? (20 điểm)",
        options: {
            a: "60% hoặc thấp hơn",
            b: "50% hoặc thấp hơn",
            c: "60% hoặc cao hơn",
            d: "55% hoặc cao hơn"
        },
        correct: "a",
        score: 20
    },
    {
        type: "choice",
        question: "Theo thử nghiệm của máy đo độ ẩm Aqua Boy, độ ẩm bao nhiêu là đúng? (20 điểm)",
        options: {
            a: "Vật liệu đóng gói là 8% hoặc thấp hơn",
            b: "Vật liệu vải hàng dệt là 7% hoặc thấp hơn",
            c: "Da là 17% hoặc thấp hơn và các sản phẩm",
            d: "Các sản phẩm & chi tiết bằng gỗ là 6% hoặc thấp hơn",
            e: "Tất cả abc đều đúng"
        },
        correct: "c",
        score: 20
    },
    {
        type: "choice",
        question: "Lò UV và tiêu chuẩn năng lượng UV là bao nhiêu? (20 điểm)",
        options: {
            a: "Tất cả các lò UV đều vượt qua kiểm tra chất lượng Micro-Pak (tiêu chuẩn: 132 – 330 mJ/cm2)",
            b: "Tất cả giày dép và vật liệu đóng gói (hộp giày, khăn giấy, miếng lót và vách ngăn) đều đi qua lò tia cực tím (UVC hoặc UVGI)",
            c: "a và b đều đúng"
        },
        correct: "d",
        score: 20
    }
];

/* ===== RENDER ===== */
const quizDiv = document.getElementById("quiz");
quizData.forEach((q,i)=>{
    let html=`<div class="question"><h3>Câu ${i+1}: ${q.question}</h3>`;
    if(q.type==="choice"){
        html+=`<div class="options">`;
        for(let k in q.options){
            html+=`<label><input type="radio" name="q${i}" value="${k}"> (${k}) ${q.options[k]}</label>`;
        }
        html+=`</div>`;
    }
    if(q.type==="text"){
        html+=`<textarea placeholder="Nhập câu trả lời..."></textarea>`;
    }
    html+=`</div>`;
    quizDiv.innerHTML+=html;
});

/* ===== SUBMIT + SCORE ===== */
function submitQuiz() {
    if (!db) {
        alert("Database chưa sẵn sàng, vui lòng thử lại");
        return;
    }
    let totalScore = 0;
    let maxScore = 0;

    quizData.forEach((q, i) => {
        maxScore += q.score;

        if (q.type === "choice") {
            const s = document.querySelector(`input[name="q${i}"]:checked`);
            if (s && s.value === q.correct) {
                totalScore += q.score;
            }
        }
    });

    // ===== ĐIỀN ĐIỂM + GHI CHÚ =====
    document.getElementById("scoreCell").innerText = totalScore;

    const resultCell = document.getElementById("resultCell");
    const ketQua = totalScore >= 70 ? "ĐẠT" : "KHÔNG ĐẠT";

    resultCell.innerText = ketQua;
    resultCell.style.color = totalScore >= 70 ? "green" : "red";

    // ===== LẤY THÔNG TIN NGƯỜI THI =====
    const nametest = document.getElementById("name-test")?.textContent.trim() || "QIP_TEST";
    const hoTen = document.getElementById("fullname")?.value.trim();
    const soThe = document.getElementById("empid")?.value.trim();

    if (!hoTen || !soThe) {
        alert("Vui lòng nhập Họ tên và Số thẻ");
        return;
    }

    const now = new Date();
    const timeStr = now.toLocaleString();
    const dateStr = now.toISOString().slice(0, 10);

    // ===== NỘI DUNG TXT =====
    const txtContent = `
${timeStr}
HoTen: ${hoTen}
SoThe: ${soThe}
Diem: ${totalScore} / ${maxScore}
KetQua: ${ketQua}
------------------------
`;

    // ===== LƯU INDEXEDDB =====
    const transaction = db.transaction(["results"], "readwrite");
    const store = transaction.objectStore("results");

    store.add({
        time: timeStr,
        hoTen,
        soThe,
        score: totalScore,
        ketQua,
        content: txtContent
    });

    transaction.oncomplete = () => {

        // ===== ĐẶT TÊN FILE PRINT =====
        const oldTitle = document.title;
        document.title = `${nametest}_${hoTen}_${soThe}_${timeStr}`;

        alert("Nộp bài thành công!");
        window.print();

        // phục hồi title
        document.title = oldTitle;
    };
}
</script>

</body>
</html>
